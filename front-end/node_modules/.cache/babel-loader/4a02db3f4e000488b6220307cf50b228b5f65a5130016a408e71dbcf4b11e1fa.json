{"ast":null,"code":"import axios from 'axios';\nimport { getLocalAccessToken, getLocalRefreshToken, updateLocalAccessToken } from 'service/token';\nfunction createAxios() {\n  const axiosInstant = axios.create();\n  axiosInstant.defaults.baseURL = process.env.REACT_APP_BASE_URL;\n  axiosInstant.defaults.timeout = 40000;\n  axiosInstant.defaults.headers = {\n    \"Content-Type\": \"application/json\",\n    \"ngrok-skip-browser-warning\": \"*\",\n    \"access-control-allow-origin\": \"*\"\n  };\n  axiosInstant.interceptors.request.use(async config => {\n    const token = getLocalAccessToken();\n    if (token) {\n      config.headers[\"Authorization\"] = `Bearer ${token}`;\n    }\n    return config;\n  }, error => Promise.reject(error));\n  axiosInstant.interceptors.response.use(response => {\n    return response;\n  }, async error => {\n    const originalConfig = error.config;\n    if (error.response.status === 401) {\n      try {\n        const refreshToken = getLocalRefreshToken();\n        const {\n          access_token,\n          refresh_token\n        } = await refreshTokenAPI(refreshToken);\n        updateLocalAccessToken(access_token, refresh_token);\n        return axiosInstant(originalConfig);\n      } catch (error) {\n        return Promise.reject(error);\n      }\n    }\n    return Promise.reject(error);\n  });\n  return axiosInstant;\n}\nexport const getAxios = createAxios();\n// function handleUrl(url: string, query: queryString.StringifiableRecord | undefined) {\n//   return queryString.stringifyUrl({ url: url, query });\n// }\n\nexport const ApiClient = {\n  // get: (url: string, payload: IPayload) => handleResult(getAxios.get(handleUrl(url, payload))),\n  post: (url, payload) => handleResult(getAxios.post(url, payload)),\n  put: (url, payload) => handleResult(getAxios.put(url, payload)),\n  path: (url, payload) => handleResult(getAxios.patch(url, payload)),\n  delete: (url, payload) => handleResult(getAxios.delete(url, {\n    data: payload\n  }))\n};\n\n/* Support function */\nfunction handleResult(api) {\n  return api.then(res => {\n    // if (res?.data?.status !== 1) {\n    //   if (res?.data?.code === 403) {\n    //     // Cookie.remove('SESSION_ID');\n    //   }\n    //   return Promise.reject(res?.data);\n    // }\n    return Promise.resolve(res === null || res === void 0 ? void 0 : res.data);\n  }).catch(error => {\n    return Promise.reject(error);\n  });\n}\nexport const loginWithLine = () => {\n  return handleResult(getAxios.get('/api/line/authorize'));\n};\nexport const getAllCharacters = () => {\n  return handleResult(getAxios.get('/aiagents'));\n};\nexport const getAgentsByUserId = userId => {\n  return handleResult(getAxios.get(`/aiagents/user/${userId}`));\n};\nexport const updateAgentAPI = (agentID, payload) => {\n  return handleResult(getAxios.get(`/aiagents/update/${agentID}`, payload));\n};\nexport const logoutAPI = () => {\n  return handleResult(getAxios.post(`/v1/logout`));\n};\nexport const refreshTokenAPI = refreshToken => {\n  return handleResult(getAxios.get(`/v1/refreshToken/${refreshToken}`));\n};\n\n// Webhook call\nexport const verifyTokenToCall = token => {\n  return handleResult(getAxios.get(`/webhook/verifyTokenToCall/${token}`));\n};","map":{"version":3,"names":["axios","getLocalAccessToken","getLocalRefreshToken","updateLocalAccessToken","createAxios","axiosInstant","create","defaults","baseURL","process","env","REACT_APP_BASE_URL","timeout","headers","interceptors","request","use","config","token","error","Promise","reject","response","originalConfig","status","refreshToken","access_token","refresh_token","refreshTokenAPI","getAxios","ApiClient","post","url","payload","handleResult","put","path","patch","delete","data","api","then","res","resolve","catch","loginWithLine","get","getAllCharacters","getAgentsByUserId","userId","updateAgentAPI","agentID","logoutAPI","verifyTokenToCall"],"sources":["D:/Nam_4/Do-an-tot-nghiep/AIChat/front-end/src/service/api/api.ts"],"sourcesContent":["import axios from 'axios';\r\nimport queryString from 'query-string';\r\nimport { getLocalAccessToken, getLocalRefreshToken, updateLocalAccessToken } from 'service/token';\r\n\r\nfunction createAxios() {\r\n  const axiosInstant = axios.create();\r\n\r\n  axiosInstant.defaults.baseURL = process.env.REACT_APP_BASE_URL;\r\n  axiosInstant.defaults.timeout = 40000;\r\n  axiosInstant.defaults.headers = {\r\n    \"Content-Type\": \"application/json\",\r\n    \"ngrok-skip-browser-warning\": \"*\",\r\n    \"access-control-allow-origin\": \"*\",\r\n  };\r\n\r\n  axiosInstant.interceptors.request.use(\r\n    async (config) => {\r\n      const token = getLocalAccessToken();\r\n      if (token) {\r\n        config.headers[\"Authorization\"] = `Bearer ${token}`;\r\n      }\r\n      return config;\r\n    },\r\n    (error) => Promise.reject(error),\r\n  );\r\n\r\n  axiosInstant.interceptors.response.use(\r\n    (response) => {\r\n      return response;\r\n    },\r\n    async (error) => {\r\n      const originalConfig = error.config;\r\n      if (error.response.status === 401) {\r\n        try {\r\n          const refreshToken = getLocalRefreshToken();\r\n          const { access_token, refresh_token } = await refreshTokenAPI(\r\n            refreshToken\r\n          );\r\n          updateLocalAccessToken(access_token, refresh_token);\r\n          return axiosInstant(originalConfig);\r\n        } catch (error) {\r\n          return Promise.reject(error);\r\n        }\r\n      }\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n\r\n  return axiosInstant;\r\n}\r\n\r\nexport const getAxios = createAxios();\r\n\r\nexport type IPayload = queryString.StringifiableRecord | undefined;\r\n\r\n// function handleUrl(url: string, query: queryString.StringifiableRecord | undefined) {\r\n//   return queryString.stringifyUrl({ url: url, query });\r\n// }\r\n\r\nexport const ApiClient = {\r\n  // get: (url: string, payload: IPayload) => handleResult(getAxios.get(handleUrl(url, payload))),\r\n  post: (url: string, payload: IPayload) => handleResult(getAxios.post(url, payload)),\r\n  put: (url: string, payload: IPayload) => handleResult(getAxios.put(url, payload)),\r\n  path: (url: string, payload: IPayload) => handleResult(getAxios.patch(url, payload)),\r\n  delete: (url: string, payload: IPayload) => handleResult(getAxios.delete(url, { data: payload })),\r\n};\r\n\r\n/* Support function */\r\nfunction handleResult<T>(api: Promise<T>) {\r\n  return api\r\n    .then((res: any) => {\r\n      // if (res?.data?.status !== 1) {\r\n      //   if (res?.data?.code === 403) {\r\n      //     // Cookie.remove('SESSION_ID');\r\n      //   }\r\n      //   return Promise.reject(res?.data);\r\n      // }\r\n      return Promise.resolve(res?.data);\r\n    })\r\n    .catch((error) => {\r\n      return Promise.reject(error);\r\n    });\r\n}\r\n\r\nexport const loginWithLine = () => {\r\n  return handleResult(getAxios.get('/api/line/authorize'));\r\n};\r\n\r\nexport const getAllCharacters = () => {\r\n  return handleResult(getAxios.get('/aiagents'));\r\n};\r\n\r\nexport const getAgentsByUserId = (userId: number) => {\r\n  return handleResult(getAxios.get(`/aiagents/user/${userId}`));\r\n};\r\n\r\nexport const updateAgentAPI = (agentID: number, payload: IPayload) => {\r\n  return handleResult(getAxios.get(`/aiagents/update/${agentID}`, payload));\r\n};\r\n\r\nexport const logoutAPI = () => {\r\n  return handleResult(getAxios.post(`/v1/logout`));\r\n};\r\n\r\nexport const refreshTokenAPI = (refreshToken: string) => {\r\n  return handleResult(\r\n    getAxios.get(`/v1/refreshToken/${refreshToken}`)\r\n  );\r\n};\r\n\r\n// Webhook call\r\nexport const verifyTokenToCall = (token: string) => {\r\n  return handleResult(getAxios.get(`/webhook/verifyTokenToCall/${token}`));\r\n};"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,SAASC,mBAAmB,EAAEC,oBAAoB,EAAEC,sBAAsB,QAAQ,eAAe;AAEjG,SAASC,WAAW,GAAG;EACrB,MAAMC,YAAY,GAAGL,KAAK,CAACM,MAAM,EAAE;EAEnCD,YAAY,CAACE,QAAQ,CAACC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,kBAAkB;EAC9DN,YAAY,CAACE,QAAQ,CAACK,OAAO,GAAG,KAAK;EACrCP,YAAY,CAACE,QAAQ,CAACM,OAAO,GAAG;IAC9B,cAAc,EAAE,kBAAkB;IAClC,4BAA4B,EAAE,GAAG;IACjC,6BAA6B,EAAE;EACjC,CAAC;EAEDR,YAAY,CAACS,YAAY,CAACC,OAAO,CAACC,GAAG,CACnC,MAAOC,MAAM,IAAK;IAChB,MAAMC,KAAK,GAAGjB,mBAAmB,EAAE;IACnC,IAAIiB,KAAK,EAAE;MACTD,MAAM,CAACJ,OAAO,CAAC,eAAe,CAAC,GAAI,UAASK,KAAM,EAAC;IACrD;IACA,OAAOD,MAAM;EACf,CAAC,EACAE,KAAK,IAAKC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CACjC;EAEDd,YAAY,CAACS,YAAY,CAACQ,QAAQ,CAACN,GAAG,CACnCM,QAAQ,IAAK;IACZ,OAAOA,QAAQ;EACjB,CAAC,EACD,MAAOH,KAAK,IAAK;IACf,MAAMI,cAAc,GAAGJ,KAAK,CAACF,MAAM;IACnC,IAAIE,KAAK,CAACG,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;MACjC,IAAI;QACF,MAAMC,YAAY,GAAGvB,oBAAoB,EAAE;QAC3C,MAAM;UAAEwB,YAAY;UAAEC;QAAc,CAAC,GAAG,MAAMC,eAAe,CAC3DH,YAAY,CACb;QACDtB,sBAAsB,CAACuB,YAAY,EAAEC,aAAa,CAAC;QACnD,OAAOtB,YAAY,CAACkB,cAAc,CAAC;MACrC,CAAC,CAAC,OAAOJ,KAAK,EAAE;QACd,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;MAC9B;IACF;IACA,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;EAC9B,CAAC,CACF;EAED,OAAOd,YAAY;AACrB;AAEA,OAAO,MAAMwB,QAAQ,GAAGzB,WAAW,EAAE;AAIrC;AACA;AACA;;AAEA,OAAO,MAAM0B,SAAS,GAAG;EACvB;EACAC,IAAI,EAAE,CAACC,GAAW,EAAEC,OAAiB,KAAKC,YAAY,CAACL,QAAQ,CAACE,IAAI,CAACC,GAAG,EAAEC,OAAO,CAAC,CAAC;EACnFE,GAAG,EAAE,CAACH,GAAW,EAAEC,OAAiB,KAAKC,YAAY,CAACL,QAAQ,CAACM,GAAG,CAACH,GAAG,EAAEC,OAAO,CAAC,CAAC;EACjFG,IAAI,EAAE,CAACJ,GAAW,EAAEC,OAAiB,KAAKC,YAAY,CAACL,QAAQ,CAACQ,KAAK,CAACL,GAAG,EAAEC,OAAO,CAAC,CAAC;EACpFK,MAAM,EAAE,CAACN,GAAW,EAAEC,OAAiB,KAAKC,YAAY,CAACL,QAAQ,CAACS,MAAM,CAACN,GAAG,EAAE;IAAEO,IAAI,EAAEN;EAAQ,CAAC,CAAC;AAClG,CAAC;;AAED;AACA,SAASC,YAAY,CAAIM,GAAe,EAAE;EACxC,OAAOA,GAAG,CACPC,IAAI,CAAEC,GAAQ,IAAK;IAClB;IACA;IACA;IACA;IACA;IACA;IACA,OAAOtB,OAAO,CAACuB,OAAO,CAACD,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEH,IAAI,CAAC;EACnC,CAAC,CAAC,CACDK,KAAK,CAAEzB,KAAK,IAAK;IAChB,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;EAC9B,CAAC,CAAC;AACN;AAEA,OAAO,MAAM0B,aAAa,GAAG,MAAM;EACjC,OAAOX,YAAY,CAACL,QAAQ,CAACiB,GAAG,CAAC,qBAAqB,CAAC,CAAC;AAC1D,CAAC;AAED,OAAO,MAAMC,gBAAgB,GAAG,MAAM;EACpC,OAAOb,YAAY,CAACL,QAAQ,CAACiB,GAAG,CAAC,WAAW,CAAC,CAAC;AAChD,CAAC;AAED,OAAO,MAAME,iBAAiB,GAAIC,MAAc,IAAK;EACnD,OAAOf,YAAY,CAACL,QAAQ,CAACiB,GAAG,CAAE,kBAAiBG,MAAO,EAAC,CAAC,CAAC;AAC/D,CAAC;AAED,OAAO,MAAMC,cAAc,GAAG,CAACC,OAAe,EAAElB,OAAiB,KAAK;EACpE,OAAOC,YAAY,CAACL,QAAQ,CAACiB,GAAG,CAAE,oBAAmBK,OAAQ,EAAC,EAAElB,OAAO,CAAC,CAAC;AAC3E,CAAC;AAED,OAAO,MAAMmB,SAAS,GAAG,MAAM;EAC7B,OAAOlB,YAAY,CAACL,QAAQ,CAACE,IAAI,CAAE,YAAW,CAAC,CAAC;AAClD,CAAC;AAED,OAAO,MAAMH,eAAe,GAAIH,YAAoB,IAAK;EACvD,OAAOS,YAAY,CACjBL,QAAQ,CAACiB,GAAG,CAAE,oBAAmBrB,YAAa,EAAC,CAAC,CACjD;AACH,CAAC;;AAED;AACA,OAAO,MAAM4B,iBAAiB,GAAInC,KAAa,IAAK;EAClD,OAAOgB,YAAY,CAACL,QAAQ,CAACiB,GAAG,CAAE,8BAA6B5B,KAAM,EAAC,CAAC,CAAC;AAC1E,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}